"use strict";angular.module("vis",["ngAnimate","ngCookies","ngTouch","ngSanitize","ngResource","ui.router","ui.bootstrap"]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("home",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"}),t.otherwise("/")}]),$("#sidebar").height($("#sidebar").siblings("#main-content").height()),$(window).resize(function(){$("#sidebar").height($("#sidebar").siblings("#main-content").height())}),angular.module("vis").controller("TemplatePropertiesCtrl",["$scope","$modalInstance","armTemplate",function(e,t,a){function r(e,t){var a=t.armTemplate.parameters;e.forEach(function(e){var r=a[e.name];if(r)r.type=e.type,r.defaultValue=e.defaultValue,r.allowedValues=e.allowedValues;else{var o=new Parameter;o.type=e.type,o.defaultValue=e.defaultValue,o.allowedValues=e.allowedValues,t.armTemplate.parameters[e.name]=o}});var r=t.getParameterNames();r.forEach(function(a){var r=_.find(e,function(e){return e.name===a});r||delete t.armTemplate.parameters[a]})}var o=new TemplateParameterManager(a),n=(new ParameterValuesTemplate.DeploymentParameters,new Array),i=o.getParameterNames();i.forEach(function(e){var t=o.getParameterData(e);n.push({name:e,type:t.type,defaultValue:t.defaultValue,allowedValues:t.allowedValues,value:""})}),e.templateParameterManager=o,e.parameterModel=n,e.save=function(){var a=e.parameterModel,o=e.templateParameterManager;r(a,o),t.close()},e.cancel=function(){t.dismiss("cancel")},e.genParamValues=function(){ParameterValueManager.generateJSON(e.parameterModel)},e.addParameter=function(){var e=new ParameterModelItem;n.push(e)},e.deleteParameter=function(e){var t=n.indexOf(e);n.splice(t,1)}}]);var TemplateParameterManager=function(){function e(e){this.armTemplate=e}return e.prototype.getParameterNames=function(){return Object.keys(this.armTemplate.parameters)},e.prototype.getParameterData=function(e){return this.armTemplate.parameters[e]},e}(),ParameterValuesTemplate;!function(e){var t=function(){function e(){}return e}();e.DeploymentParameters=t;var a=function(){function e(e){this.value=e}return e}();e.Parameter=a}(ParameterValuesTemplate||(ParameterValuesTemplate={}));var ParameterValueManager;!function(e){function t(e){var t=new a.DeploymentParameters;t.$schema="http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentParameters.json",t.contentVersion="1.0.0.0",t.parameters={p:a.Parameter},e.forEach(function(e){t.parameters[e.name]=new a.Parameter(e.value)});var r=JSON.stringify(t,null,2),o=new Blob([r],{type:"text/json"}),n=document.createEvent("MouseEvents"),i=document.createElement("a");i.download="ARMTemplate.params.json",i.href=window.URL.createObjectURL(o),i.dataset.downloadurl=["text/json",i.download,i.href].join(":"),n.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(n)}var a=ParameterValuesTemplate;e.generateJSON=t}(ParameterValueManager||(ParameterValueManager={}));var ParameterModelItem=function(){function e(){}return e}();angular.module("vis").controller("ResourceEditorController",["$scope","$modalInstance","arm","resource",function(e,t,a,r){e.arm=a,e.resource=r,e.resourceJson=JSON.stringify(r,null,2),e.validate=function(){try{JSON.parse(e.resourceJson),e.validationResult="Valid JSON!"}catch(t){e.validationResult="Invalid JSON: "+t.toString()}},e["delete"]=function(){if(confirm("Are you sure you want to delete this resource?")){var a=e.resource;a.deleteFlag=!0,t.close(a)}},e.save=function(){var a;try{a=JSON.parse(e.resourceJson)}catch(o){return void alert("Invalid JSON: "+o.toString())}for(var n in r)r.hasOwnProperty(n)&&delete r[n];$.extend(r,a),t.close(r)},e.cancel=function(){t.dismiss("cancel")}}]),angular.module("vis").controller("QuickstartLoadDialog",["$scope","$modalInstance","$http",function(e,t,a){function r(t){e.categories=t}var o=new GithubTemplateReader;o.getTemplateCategories(a,r),e.categorySelected=function(){var t=e.selectedCategory;o.getTemplateMetadata(a,t,function(t){e.templateMetadata=t})},e.cancel=function(){t.dismiss("cancel")},e.open=function(){var r=e.selectedCategory;o.getTemplate(a,r,function(e,a){return a?void alert("Error parsing template: "+a):void t.close(e)})}}]);var GithubTemplateReader=function(){function e(){this.GithubApiRoot="https://api.github.com/",this.GithubTemplateRoot=this.GithubApiRoot+"repos/Azure/azure-quickstart-templates/contents/"}return e.prototype.getTemplateCategories=function(e,t){var a=this.GithubTemplateRoot;e.get(a).success(function(e){var a=new Array;e.forEach(function(e){if("dir"===e.type){var t=new TemplateCategory;t.name=e.name,t.url=e.url,t.html_url=e.html_url,a.push(t)}}),t(a)}).error(function(e){throw new Error("Error in GitHub template reader getting data from GitHub "+e)})},e.prototype.getTemplateMetadata=function(e,t,a){e.get(this.GithubTemplateRoot+t.name+"/metadata.json").success(function(e){if("base64"!==e.encoding)throw new Error("Github template reader was expecting base64 encoded file");var t=atob(e.content),r=JSON.parse(t);a(r)})},e.prototype.getTemplate=function(e,t,a){e.get(this.GithubTemplateRoot+t.name+"/azuredeploy.json").success(function(e){if("base64"!==e.encoding)throw new Error("Github template reader was expecting base64 encoded file");var t=e.content,r="77u/";t.substring(0,r.length)===r&&(t=t.substring(r.length,t.length));var o,n=atob(t),i=null;try{i=ArmTemplate.CreateFromJson(n)}catch(s){o=s.toString()}a(i,o)})},e}(),TemplateCategory=function(){function e(){}return e}();angular.module("vis").controller("OpenDialog.controller",["$scope","$modalInstance","$http",function(e,t){e.cancel=function(){t.dismiss("cancel")},e.open=function(){var a=new FileReader;a.onload=function(e){var a=e.target.result,r=ArmTemplate.CreateFromJson(a);t.close(r)},a.readAsText(e.file)}}]),angular.module("vis").directive("ngFileSelect",function(){return{link:function(e,t){t.bind("change",function(t){e.file=(t.srcElement||t.target).files[0],e.$apply()})}}});var arm={$schema:"http://schema.management.azure.com/schemas/2014-04-01-preview/deploymentTemplate.json",contentVersion:"1.0.0.0",parameters:{region:{type:"string"},storageAccountName:{type:"string",defaultValue:"uniqueStorageAccountName"},adminUsername:{type:"string"},adminPassword:{type:"securestring"},dnsNameforLBIP:{type:"string",defaultValue:"uniqueDnsNameforLBIP"},subscriptionId:{type:"string"},backendPort:{type:"int",defaultValue:3389},vmNamePrefix:{type:"string",defaultValue:"myVM"},vmSourceImageName:{type:"string",defaultValue:"a699494373c04fc0bc8f2bb1389d6106__Windows-Server-2012-R2-201412.01-en.us-127GB.vhd"},lbName:{type:"string",defaultValue:"myLB"},nicNamePrefix:{type:"string",defaultValue:"nic"},publicIPAddressName:{type:"string",defaultValue:"myPublicIP"},vnetName:{type:"string",defaultValue:"myVNET"},vmSize:{type:"string",defaultValue:"Standard_A1",allowedValues:["Standard_A0","Standard_A1","Standard_A2","Standard_A3","Standard_A4"]}},variables:{storageAccountType:"Standard_LRS",vmStorageAccountContainerName:"vhds",availabilitySetName:"myAvSet",addressPrefix:"10.0.0.0/16",subnetName:"Subnet-1",subnetPrefix:"10.0.0.0/24",publicIPAddressType:"Dynamic",vnetID:"[resourceId('Microsoft.Network/virtualNetworks',parameters('vnetName'))]",subnetRef:"[concat(variables('vnetID'),'/subnets/',variables ('subnetName'))]",publicIPAddressID:"[resourceId('Microsoft.Network/publicIPAddresses',parameters('publicIPAddressName'))]",lbID:"[resourceId('Microsoft.Network/loadBalancers',parameters('lbName'))]",numberOfInstances:2,nicId1:"[resourceId('Microsoft.Network/networkInterfaces',concat(parameters('nicNamePrefix'), 0))]",nicId2:"[resourceId('Microsoft.Network/networkInterfaces',concat(parameters('nicNamePrefix'), 1))]",frontEndIPConfigID:"[concat(variables('lbID'),'/frontendIPConfigurations/LBFE')]",backEndIPConfigID1:"[concat(variables('nicId1'),'/ipConfigurations/ipconfig1')]",backEndIPConfigID2:"[concat(variables('nicId2'),'/ipConfigurations/ipconfig1')]",sourceImageName:"[concat('/',parameters('subscriptionId'),'/services/images/',parameters('vmSourceImageName'))]",lbPoolID:"[concat(variables('lbID'),'/backendAddressPools/LBBE')]",lbProbeID:"[concat(variables('lbID'),'/probes/tcpProbe')]"},resources:[{type:"Microsoft.Storage/storageAccounts",name:"[parameters('storageAccountName')]",apiVersion:"2014-12-01-preview",location:"[parameters('region')]",properties:{accountType:"[variables('storageAccountType')]"}},{type:"Microsoft.Compute/availabilitySets",name:"[variables('availabilitySetName')]",apiVersion:"2014-12-01-preview",location:"[parameters('region')]",properties:{}},{apiVersion:"2014-12-01-preview",type:"Microsoft.Network/publicIPAddresses",name:"[parameters('publicIPAddressName')]",location:"[parameters('region')]",properties:{publicIPAllocationMethod:"[variables('publicIPAddressType')]",dnsSettings:{domainNameLabel:"[parameters('dnsNameforLBIP')]"}}},{apiVersion:"2014-12-01-preview",type:"Microsoft.Network/virtualNetworks",name:"[parameters('vnetName')]",location:"[parameters('region')]",properties:{addressSpace:{addressPrefixes:["[variables('addressPrefix')]"]},subnets:[{name:"[variables('subnetName')]",properties:{addressPrefix:"[variables('subnetPrefix')]"}}]}},{apiVersion:"2014-12-01-preview",type:"Microsoft.Network/networkInterfaces",name:"[concat(parameters('nicNamePrefix'), copyindex())]",location:"[parameters('region')]",copy:{name:"nicLoop",count:"[variables('numberOfInstances')]"},dependsOn:["[concat('Microsoft.Network/virtualNetworks/', parameters('vnetName'))]"],properties:{ipConfigurations:[{name:"ipconfig1",properties:{privateIPAllocationMethod:"Dynamic",subnet:{id:"[variables('subnetRef')]"}}}]}},{apiVersion:"2014-12-01-preview",name:"[parameters('lbName')]",type:"Microsoft.Network/loadBalancers",location:"[parameters('region')]",dependsOn:["nicLoop","[concat('Microsoft.Network/publicIPAddresses/', parameters('publicIPAddressName'))]"],properties:{frontendIPConfigurations:[{name:"LBFE",properties:{publicIPAddress:{id:"[variables('publicIPAddressID')]"}}}],backendAddressPools:[{name:"LBBE",properties:{backendIPConfigurations:[{id:"[variables('backEndIPConfigID1')]"},{id:"[variables('backEndIPConfigID2')]"}]}}],inboundNatRules:[{name:"RDP-VM1",properties:{frontendIPConfigurations:[{id:"[variables('frontEndIPConfigID')]"}],backendIPConfiguration:{id:"[variables('backEndIPConfigID1')]"},protocol:"tcp",frontendPort:50001,backendPort:3389,enableFloatingIP:!1}},{name:"RDP-VM2",properties:{frontendIPConfigurations:[{id:"[variables('frontEndIPConfigID')]"}],backendIPConfiguration:{id:"[variables('backEndIPConfigID2')]"},protocol:"tcp",frontendPort:50002,backendPort:3389,enableFloatingIP:!1}}],loadBalancingRules:[{name:"LBRule",properties:{frontendIPConfigurations:[{id:"[variables('frontEndIPConfigID')]"}],backendAddressPool:{id:"[variables('lbPoolID')]"},protocol:"tcp",frontendPort:80,backendPort:80,enableFloatingIP:!1,idleTimeoutInMinutes:5,probe:{id:"[variables('lbProbeID')]"}}}],probes:[{name:"tcpProbe",properties:{protocol:"tcp",port:80,intervalInSeconds:"5",numberOfProbes:"2"}}]}},{apiVersion:"2014-12-01-preview",type:"Microsoft.Compute/virtualMachines",name:"[concat(parameters('vmNamePrefix'), copyindex())]",copy:{name:"virtualMachineLoop",count:"[variables('numberOfInstances')]"},location:"[parameters('region')]",dependsOn:["[concat('Microsoft.Storage/storageAccounts/', parameters('storageAccountName'))]","[concat('Microsoft.Network/networkInterfaces/', parameters('nicNamePrefix'), copyindex())]","[concat('Microsoft.Compute/availabilitySets/', variables('availabilitySetName'))]"],properties:{availabilitySet:{id:"[resourceId('Microsoft.Compute/availabilitySets',variables('availabilitySetName'))]"},hardwareProfile:{vmSize:"[parameters('vmSize')]"},osProfile:{computername:"[concat(parameters('vmNamePrefix'), copyIndex())]",adminUsername:"[parameters('adminUsername')]",adminPassword:"[parameters('adminPassword')]"},storageProfile:{sourceImage:{id:"[variables('sourceImageName')]"},destinationVhdsContainer:"[concat('http://',parameters('storageAccountName'),'.blob.core.windows.net/',variables('vmStorageAccountContainerName'),'/')]"},networkProfile:{networkInterfaces:[{id:"[resourceId('Microsoft.Network/networkInterfaces',concat(parameters('nicNamePrefix'),copyindex()))]"}]}}}]};angular.module("vis").controller("MainCtrl",["$scope","$modal",function(e,t){function a(e){var t=new Blob([e],{type:"text/json"}),a=document.createEvent("MouseEvents"),r=document.createElement("a");r.download="armTemplate.json",r.href=window.URL.createObjectURL(t),r.dataset.downloadurl=["text/json",r.download,r.href].join(":"),a.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(a)}e.toolboxItems=toolboxItems;var r=arm,o=new ArmTemplate(r),n=new Graph(toolboxItems);n.applyTemplate(o),n.resourceSelected=function(a,r){if(r){var n=t.open({templateUrl:"/app/resourceEditorDialog/ResourceEditor.html",controller:"ResourceEditorController",resolve:{arm:function(){return o},resource:function(){return a}}});n.result.then(function(e){e&&e.deleteFlag&&o.deleteResource(e)})}else e.selectedResource=JSON.stringify(a,null,2),e.$apply()},e.downloadArmTemplate=function(){var e=o.toJson();a(e,"armTemplate.json")},e.openExistingTemplate=function(){var e=t.open({templateUrl:"/app/openExistingTemplateDialog/OpenDialog.html",controller:"OpenDialog.controller"});e.result.then(function(e){o=e,n.applyTemplate(e)})},e.loadArmQuickstartTemplate=function(){var e=t.open({templateUrl:"/app/quickstartLoadDialog/QuickstartLoadDialog.html",controller:"QuickstartLoadDialog"});e.result.then(function(e){o=e,n.applyTemplate(e)})},e.openTemplateProperties=function(){t.open({templateUrl:"/app/templateParameterEditor/TemplateProperties.html",controller:"TemplatePropertiesCtrl",size:"lg",resolve:{armTemplate:function(){return o}}})},e.toolboxItemClick=function(e){var t=new Resource(e);o.resources.push(t)},e.addShape=function(e){if("group"===e){var t=new Group;n.addInertShape(t),t.toBack()}}}]);var Graph=function(){function e(e){this.resourceShapes=new Array,this.resourceShapeLinks=new Array,this.toolboxItems=e,this.initJointJs(),this.initializeClickPopup()}return e.prototype.applyTemplate=function(e){this.reset(),this.template=e,this.createNodes(),this.createLinks(),this.autoSetShapePositions(),this.displayNodesAndLinks(),this.watchModel()},e.prototype.watchModel=function(){var e=this;this.template.resources.subscribe(function(t){t.forEach(function(t){if("added"===t.status){var a=e.addResource(t.value);e.addShape(a)}else"deleted"===t.status&&e.removeResourceShape(t.value)})},null,"arrayChange")},e.prototype.reset=function(){this.resourceShapes=new Array,this.resourceShapeLinks=new Array,this.graph.clear()},e.prototype.initJointJs=function(){this.graph=new joint.dia.Graph,this.paper=new joint.dia.Paper({el:$("#paper"),gridSize:1,model:this.graph,height:"100%",width:"100%"})},e.prototype.createNodes=function(){var e=this;ko.utils.arrayForEach(this.template.resources(),function(t){e.addResource(t)})},e.prototype.addResource=function(e){var t=this.getToolboxItemForResource(e),a=new ResourceShape(e,t);return a.position(60,60),a.resize(110,80),this.resourceShapes.push(a),a},e.prototype.addInertShape=function(e){e.position(60,60),this.graph.addCell(e)},e.prototype.displayNodesAndLinks=function(){var e=this;this.resourceShapes.forEach(function(t){e.addShape(t)}),this.resourceShapeLinks.forEach(function(t){e.addShapeLink(t)});var t=this.paper.getContentBBox();this.paper.fitToContent(t.width,t.height+400)},e.prototype.createLinks=function(){var e=this,t=this;ko.utils.arrayForEach(this.template.resources(),function(a){var r=t.template.getDependencies(a);r.forEach(function(r){var o=t.getShapeForResource(a),n=t.getShapeForResource(r),i=new joint.dia.Link({source:{id:o.id},target:{id:n.id},attrs:{".connection":{"stroke-width":3,stroke:"#34495E"},".marker-target":{fill:"black",d:"M 10 0 L 0 5 L 10 10 z"}}});e.resourceShapeLinks.push(i)})})},e.prototype.addShape=function(e){this.graph.addCell(e)},e.prototype.addShapeLink=function(e){this.graph.addCell(e)},e.prototype.removeResourceShape=function(e){var t=this.getShapeForResource(e);t.remove()},e.prototype.getToolboxItemForResource=function(e){var t=null;return this.toolboxItems.forEach(function(a){a.resourceType===e.type&&(t=a)}),t},e.prototype.getShapeForResource=function(e){var t;return this.resourceShapes.forEach(function(a){a.sourceResource===e&&(t=a)}),t},e.prototype.initializeClickPopup=function(){var e=this;this.paper.on("cell:pointerdown",function(t){var a=t.model;e.displayResource(a.sourceResource,!1)}),this.paper.on("cell:pointerdblclick",function(t){var a=t.model;e.displayResource(a.sourceResource,!0)})},e.prototype.displayResource=function(e,t){this.resourceSelected&&this.resourceSelected(e,t)},e.prototype.autoSetShapePositions=function(){var e=this,t=new dagre.graphlib.Graph;t.setGraph({}),t.setDefaultEdgeLabel(function(){return{}}),this.resourceShapes.forEach(function(e){t.setNode(e.id,{width:e.attributes.size.width,height:e.attributes.size.height})}),this.resourceShapeLinks.forEach(function(e){t.setEdge(e.attributes.source.id,e.attributes.target.id)}),dagre.layout(t),t.nodes().forEach(function(a){var r=_.findWhere(e.resourceShapes,{id:a});r.attributes.position.x=t.node(a).x,r.attributes.position.y=t.node(a).y+50})},e}(),ToolboxResource=function(){function e(e,t,a){this.iconName=e,this.friendlyName=t,this.resourceType=a}return e}(),toolboxItems=[new ToolboxResource("Virtual machine.png","Virtual Machine","Microsoft.Compute/virtualMachines"),new ToolboxResource("Unidentified feature object.png","VM Extension","Microsoft.Compute/virtualMachines/extensions"),new ToolboxResource("Availability Set.png","Availability Set","Microsoft.Compute/availabilitySets"),new ToolboxResource("Azure load balancer.png","Load Balancer","Microsoft.Network/loadBalancers"),new ToolboxResource("Virtual Network.png","VPN","Microsoft.Network/virtualNetworks"),new ToolboxResource("NIC.png","NIC","Microsoft.Network/networkInterfaces"),new ToolboxResource("Service Endpoint.png","Public IP","Microsoft.Network/publicIPAddresses"),new ToolboxResource("Unidentified feature object.png","NSG","Microsoft.Network/networkSecurityGroups"),new ToolboxResource("Unidentified feature object.png","App Gateway","Microsoft.Network/applicationGateways"),new ToolboxResource("Storage (Azure).png","Storage Acct","Microsoft.Storage/storageAccounts"),new ToolboxResource("Unidentified feature object.png","Automation","Microsoft.Automation/automationAccounts"),new ToolboxResource("Logic App.png","Workflow","Microsoft.Logic/workflows"),new ToolboxResource("Unidentified feature object.png","Deployment","Microsoft.Resources/deployments"),new ToolboxResource("Web App (was Websites).png","Server Farm","Microsoft.Web/serverfarms"),new ToolboxResource("Cloud Service.png","Hosting Env","Microsoft.Web/hostingEnvironments"),new ToolboxResource("Key Vault.png","Key Vault","Microsoft.KeyVault/vaults")],__extends=this&&this.__extends||function(e,t){function a(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);a.prototype=t.prototype,e.prototype=new a},Shape=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(joint.shapes.basic.Rect),Group=function(e){function t(){e.call(this,{size:{height:300,width:300}}),this.markup='<a><g class="rotatable"><text/><g class="scalable"><rect/></g></g></a>',this.attr({rect:{fill:"#FFFFFF","fill-opacity":0,"stroke-width":3,"z-index":-1},text:{ref:"rect","ref-y":12,"x-alignment":"middle",text:"foo group",fill:"#000000","font-size":16}})}return __extends(t,e),t}(Shape),__extends=this&&this.__extends||function(e,t){function a(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);a.prototype=t.prototype,e.prototype=new a},ResourceShapeLink=function(e){function t(){e.apply(this,arguments)}return __extends(t,e),t}(joint.dia.Link),__extends=this&&this.__extends||function(e,t){function a(){this.constructor=e}for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);a.prototype=t.prototype,e.prototype=new a},ResourceShape=function(e){function t(t,a){e.call(this),this.markup='<a><g class="rotatable"><g class="scalable"><rect/></g><image/><text/></g></a>',this.sourceResource=t,this.sourceToolboxItem=a,a?(this.titleText=a.friendlyName,this.attributes.attrs.image={"ref-x":25,"ref-y":5,ref:"rect",width:60,height:60},this.PNGRef="/assets/toolbox-icons/"+a.iconName,this.attributes.attrs.image["xlink:href"]=this.PNGRef,this.attributes.attrs.text={"ref-dy":-15,ref:"rect","ref-x":55,"x-alignment":"middle",text:a.friendlyName,fill:"#000000"}):this.titleText=this.sourceResource.type,this.attributes.attrs.rect.fill="#FFFFFF",this.attributes.attrs.rect.stroke="#0079D6",this.attributes.attrs.rect["stroke-width"]=2}return __extends(t,e),Object.defineProperty(t.prototype,"titleText",{set:function(e){this.attributes.attrs.text.text=e},enumerable:!0,configurable:!0}),t}(joint.shapes.basic.Rect),Resource=function(){function e(e){e&&(this.type=e.resourceType,this.name=e.friendlyName)}return e.getResourceId=function(e){var t=e.type+"/";return t+="["===e.name.charAt(0)?e.name.substring(1,e.name.length-1):e.name},e}(),Parameter=function(){function e(){}return e}(),ParserState;!function(e){e[e.NEW=0]="NEW",e[e.CAPTURE_OPERAND=1]="CAPTURE_OPERAND",e[e.NESTED_EXPRESSION=2]="NESTED_EXPRESSION"}(ParserState||(ParserState={}));var Expression=function(){function e(){this.operator="",this.operands=new Array}return e.prototype.convertToString=function(){var t=this.operator;t+="(";for(var a=0;a<this.operands.length;a++){var r=this.operands[a];t+=r instanceof e?"<<!notsupported!>>":"'"+r+"'",a<this.operands.length-1&&(t+=",")}return t+=")"},e}(),ExpressionParser=function(){function e(){}return e.prototype.parse=function(e){for(var t="",a=new Expression,r=ParserState.NEW,o=0;o<e.length;o++){var n=e.charAt(o);if(r===ParserState.NEW)"("===n?(a.operator=t,t="",r=ParserState.CAPTURE_OPERAND):t+=n;else if(r===ParserState.CAPTURE_OPERAND)"'"===n&&0===t.length||("'"===n?t.length>0&&(a.operands.push(t),t=""):" "===n||(","===n?t.length>0&&(a.operands.push(t),t=""):")"===n?t.length>0&&(a.operands.push(t),t=""):"("===n?(t+=n,r=ParserState.NESTED_EXPRESSION):t+=n));else if(r===ParserState.NESTED_EXPRESSION)if(")"===n){t+=")";var i=this.parse(t);a.operands.push(i),t="",r=ParserState.CAPTURE_OPERAND}else t+=n}return a},e}(),ExpressionEvaluator=function(){function e(e){this.armTemplate=e}return e.prototype.resolveDependsOnId=function(e){if("concat"!==e.operator)return"";for(var t="",a=0;a<e.operands.length;a++){var r=e.operands[a];t+=r instanceof Expression?r.convertToString():r}return t},e.prototype.evaluateExpression=function(){throw new Error("Not supported")},e}(),ArmTemplate=function(){function e(e){this.templateData=e}return e.CreateFromJson=function(t){var a=JSON.parse(t);if(!a.contentVersion)throw new Error("Azure Resource Template JSON did not have a contentVersion property");a.resources||(a.resources=new Array);var r=new e(a);return r},e.prototype.toJson=function(){return JSON.stringify(this.templateData,null,2)},Object.defineProperty(e.prototype,"resources",{get:function(){return this.observableResources?this.observableResources:(this.observableResources=ko.observableArray(this.templateData.resources),this.observableResources)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parameters",{get:function(){return this.templateData.parameters},enumerable:!0,configurable:!0}),e.prototype.getDependencies=function(e){var t=this,a=this.getDependencyNames(e.dependsOn),r=new Array;return a.forEach(function(e){t.templateData.resources.forEach(function(t){(t.name===e||Resource.getResourceId(t)===e)&&r.push(t)})}),r},e.prototype.getDependencyNames=function(e){var t=this,a=[];if(e&&Array.isArray(e)){var r=e;r.forEach(function(e){var r=t.getDependencyNames(e);r&&r.length>0&&(a=a.concat(r))})}else if(e){var o=e;if(0===o.indexOf("[")){var n=new ExpressionParser,i=n.parse(o.substring(1,o.length-2)),s=new ExpressionEvaluator(null),l=s.resolveDependsOnId(i);a.push(l)}}return a},e.prototype.deleteResource=function(e){this.resources.remove(e)},e}();angular.module("vis").controller("NavbarCtrl",["$scope",function(e){e.date=new Date}]),angular.module("vis").run(["$templateCache",function(e){e.put("app/main/main.html",'<nav class="navbar navbar-inverse navbar-fixed-top"><div class="container-fluid"><div class="navbar-header"><button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar"><span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span></button> <a class="navbar-brand" href="#">Azure Resource Visualizer</a></div></div></nav><div class="container-fluid"><div class="row"><div class="sidebar col-md-4 toolbox"><button class="btn btn-default" ng-click="openExistingTemplate()" style="width: 250px; margin-bottom: 3px;">Open Existing Template</button><br><button class="btn btn-default" ng-click="loadArmQuickstartTemplate()" style="width: 250px; margin-bottom: 3px;">Load ARM Quickstart Template</button><br><button class="btn btn-default" ng-click="openTemplateProperties()" style="width: 250px; margin-bottom: 3px;">Edit Parameter Definitions</button><br><button class="btn btn-default" ng-click="downloadArmTemplate()" style="width: 250px; margin-bottom: 3px;">Download ARM Template</button><br><h4>Toolbox</h4><a ng-repeat="toolboxItem in toolboxItems" class="itemContainer" ng-click="toolboxItemClick(toolboxItem)"><img class="icon" src="/assets/toolbox-icons/{{toolboxItem.iconName}}"> <span class="label">{{toolboxItem.friendlyName}}</span></a><h4>Other Elements</h4><a class="itemContainer" ng-click="addShape(\'group\')"><span class="label">Group</span></a><br><span ng-show="selectedResource"><h4>Selected Node Properties</h4><textarea ng-model="selectedResource" readonly="" style="width: 100%; height: 200px; max-height: 200px; resize: none;">\r\n             </textarea></span></div><div class="col-md-offset-4 col-md-8 main"><div id="paper" class="paper" style="height: 1000px; width: 800px;"></div></div></div></div>'),e.put("app/openExistingTemplateDialog/OpenDialog.html",'<div class="modal-header"><h3 class="modal-title">Open Template</h3></div><div class="modal-body"><input type="file" ng-file-select="onFileSelect($files)"></div><div class="modal-footer"><button class="btn btn-primary" ng-click="open()" ng-disabled="!file">Open</button> <button class="btn btn-warning" ng-click="cancel()">Cancel</button></div>'),e.put("app/quickstartLoadDialog/QuickstartLoadDialog.html",'<div class="modal-header"><h3 class="modal-title">Quickstart Template Loader</h3></div><div class="modal-body"><select ng-model="selectedCategory" ng-options="category.name for category in categories" ng-change="categorySelected()"></select><div ng-show="templateMetadata"><br><b>Name:</b> {{ templateMetadata.itemDisplayName }}<br><b>Description:</b> {{ templateMetadata.description }}<br><b>Summary:</b> {{ templateMetadata.summary }}<br><b>GitHub Username:</b> {{ templateMetadata.githubUsername }}<br><b>Date Updated:</b> {{ templateMetadata.dateUpdated }}<br></div></div><div class="modal-footer"><button class="btn btn-primary" ng-click="open()">Open</button> <button class="btn btn-warning" ng-click="cancel()">Cancel</button></div>'),e.put("app/resourceEditorDialog/ResourceEditor.html",'<div class="modal-header"><h3 class="modal-title">Resource Properties</h3></div><div class="modal-body"><textarea ng-model="resourceJson" spellcheck="false" style="height: 400px; width: 100%; max-height: 400px; resize: none;">\r\n    </textarea> <b>{{validationResult}}</b></div><div class="modal-footer"><button class="btn btn-danger" ng-click="delete()">Delete</button> <button class="btn btn-info" ng-click="validate()">Validate</button> <button class="btn btn-primary" ng-click="save()">Save</button> <button class="btn btn-warning" ng-click="cancel()">Cancel</button></div>'),e.put("app/templateParameterEditor/TemplateProperties.html",'<div class="modal-header"><h3 class="modal-title">Parameter Editor</h3></div><div class="modal-body"><table><thead></thead><td>Name</td><td>Type</td><td>Default Value</td><td>Allowed Values</td><td>Deployment Value</td><td></td><tbody><tr ng-repeat="parameter in parameterModel"><td><input type="text" ng-model="parameter.name"></td><td><input type="text" ng-model="parameter.type" style="width: 120px;"></td><td><input type="text" ng-model="parameter.defaultValue"></td><td><input type="text" ng-model="parameter.allowedValues"></td><td><input type="text" ng-model="parameter.value"></td><td><button ng-click="deleteParameter(parameter)">Delete</button></td></tr></tbody></table><button ng-click="addParameter()">Add</button></div><div class="modal-footer"><button class="btn btn-primary" ng-click="save()">Save</button> <button class="btn btn-warning" ng-click="cancel()">Cancel</button> <button class="btn btn-info" ng-click="genParamValues()">Download Parameter Values JSON</button></div>'),e.put("app/components/navbar/navbar.html",'<nav class="navbar navbar-static-top navbar-inverse" ng-controller="NavbarCtrl"><div class="container-fluid"><div class="navbar-header"><a class="navbar-brand" href="https://github.com/Swiip/generator-gulp-angular"><span class="glyphicon glyphicon-home"></span> Gulp Angular</a></div><div class="collapse navbar-collapse" id="bs-example-navbar-collapse-6"><ul class="nav navbar-nav"><li class="active"><a ng-href="#">Home</a></li><li><a ng-href="#">About</a></li><li><a ng-href="#">Contact</a></li></ul><ul class="nav navbar-nav navbar-right"><li>Current date: {{ date | date:\'yyyy-MM-dd\' }}</li></ul></div></div></nav>')}]);